App.Kaelin.Action.end_action_turn(glob: App.Kaelin.State.global): App.Kaelin.State.global
  open glob
  case glob.stage {
    action:
      new_glob = glob@stage <- App.Kaelin.Stage.planning(0, 0, glob@map)
      new_glob = new_glob@round <- new_glob@round + 1
      new_glob = new_glob@skills_list <- []
      new_glob = new_glob@map <- App.Kaelin.Map.creature.restore_all_ap(new_glob@map)
      new_glob
  } default glob